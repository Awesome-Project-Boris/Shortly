<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Profile – Shortly</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />

    <link
      href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="../css/indexStyles.css" />
    <link rel="stylesheet" href="../css/global.css" />
    <link rel="stylesheet" href="../css/profile.css" />

    <script defer src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script
      defer
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
    <script
      defer
      src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"
    ></script>
    <script
      defer
      src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
      crossorigin="anonymous"
    ></script>

    <script defer src="../script/mockUsers.js"></script>
    <!-- MOCK -->
    <script defer src="../script/global.js"></script>
    <script defer src="../script/profile.js"></script>
  </head>

  <body>
    <header
      class="navbar navbar-expand-lg navbar-light bg-light shadow-sm"
    ></header>

    <main class="main container py-5 text-center">
      <div class="profile-info">
        <img
          src="../media/user images/default-user.png"
          alt="Profile Picture"
          class="profile-pic"
        />
        <h1 id="userName">User name:</h1>
        <h2 id="user-name">Full Name:</h2>
        <p id="address">Address:</p>
        <p id="phone-number">Phone Number:</p>
        <p id="user-joined">Date Joined:</p>
        <p id="user-items-count">Links created:</p>

        <!-- Friend Request Button -->
        <button
          id="friendRequestBtn"
          class="btn btn-primary mt-3"
          style="display: none"
        >
          Add Friend
        </button>
      </div>

      <div class="section-header">
        <h2 class="section-title">Public links</h2>
        <hr class="divider" />
      </div>

      <div class="table-card">
        <table id="linksTable" class="table table-striped table-hover mb-0">
          <thead>
            <tr>
              <th>Link name</th>
              <th>Description</th>
              <th>Link</th>
              <th class="visibility-col">Visible/Private</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="section-header mt-5">
        <h2 class="section-title">Achievements</h2>
        <hr class="divider" />
      </div>
      <div
        id="achievementsContainer"
        class="achievements-section row g-4 justify-content-center"
      >
      </div>
    </main>

    <div class="modal fade" id="linkDetailModal" tabindex="-1" aria-labelledby="linkDetailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 id="linkDetailModalLabel" class="modal-title">Link Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <!-- Click stats by country -->
        <div class="mb-3">
          <h6>Clicks by Country</h6>
          <ul id="countryStats" class="list-unstyled ps-3 mb-0">
            <!-- Stats will be populated here by JavaScript -->
          </ul>
        </div>
        <hr/>

        <!-- Visibility toggle -->
        <div class="form-check form-switch mb-3">
          <input class="form-check-input" type="checkbox" role="switch" id="linkVisibilitySwitch" />
          <label class="form-check-label" for="linkVisibilitySwitch">
            Visible to Public
          </label>
        </div>
        <hr/>
        
        <!-- Password Protection Section -->
        <div id="passwordSection">
            <h6>Password Protection</h6>
            <!-- New: Current Password Input -->
            <div class="mb-3">
              <label for="currentPassword" class="form-label">Current Password</label>
              <input type="password" id="currentPassword" class="form-control" placeholder="Enter current password">
            </div>

            <!-- New: New Password Input -->
            <div class="mb-3">
              <label for="newPassword" class="form-label">New Password</label>
              <input type="password" id="newPassword" class="form-control" placeholder="Enter new password (min 4 chars)">
              <small id="passwordUpdateError" class="text-danger"></small>
            </div>
            
            <!-- New: Change Password Button -->
            <button id="changePasswordBtn" class="btn btn-primary btn-sm mb-3">Change Password</button>

            <!-- New: Forgot Password Feature -->
            <div id="forgotPasswordContainer">
                <button id="forgotPasswordBtn" class="btn btn-link btn-sm p-0">Forgot Password?</button>
                <div id="revealedPassword" class="alert alert-dark mt-2" style="display: none;">
                    <span class="fw-bold">Your password is:</span>
                    <span id="revealedPasswordText"></span>
                </div>
            </div>
        </div>

      </div>

      <div class="modal-footer">
        <button id="deleteLinkBtn" type="button" class="btn btn-danger me-auto">Delete Link</button>
        <button id="saveLinkChangesBtn" type="button" class="btn btn-primary">Save Visibility</button>
      </div>
    </div>
  </div>
</div>

 <!-- Enter password protected link modal-->

    <div class="modal fade" id="passwordAccessModal" tabindex="-1" aria-labelledby="passwordAccessModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" style="max-width: 400px;">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header border-0 text-center d-block">
        <h5 class="modal-title" id="passwordAccessModalLabel">
            <img src="../media/lock.png" width="20" alt="Protected" class="me-2" style="margin-top: -4px;">
            Password Required
        </h5>
      </div>
      <div class="modal-body px-4">
        <p class="text-muted text-center small" id="passwordAccessDescription">This link is protected. Please enter the password to continue.</p>
        <div class="mb-3">
          <input type="password" id="accessPasswordInput" class="form-control form-control-lg text-center" placeholder="••••••••">
          <small id="passwordAccessError" class="text-danger d-block text-center mt-2"></small>
        </div>
      </div>
      <div class="modal-footer border-0 pt-0">
        <button id="unlockLinkBtn" type="button" class="btn btn-primary w-100 btn-lg">Unlock Link</button>
      </div>
    </div>
  </div>
</div>

  </body>
</html>
